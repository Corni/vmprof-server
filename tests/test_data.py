import copy

from server.process import process

RAW_DATA = {
    u'addresses': {
        u'140606860724399': u'py:/src/vmprof-python/vmprof/__init__.py:func:47',
        u'140606861238831': u'py:vmprof-python/example.py:main:12',
        u'140606861294511': u'py:vmprof-python/example.py:<module>:1',
        u'140606861529647': u'py:vmprof-python/example.py:test_1:4',
        u'140606861530031': u'py:vmprof-python/example.py:test_2:8'},
    u'profiles': [
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1]]
}


def test_top():
    data = process(copy.deepcopy(RAW_DATA))

    assert data['top'] == [
        {'line': u'1',
         'time': 100,
         'id': u'py:vmprof-python/example.py:<module>:1',
         'file': u'vmprof-python/example.py', 'name': u'<module>'},

        {'line': u'47',
         'time': 100,
         'id': u'py:/src/vmprof-python/vmprof/__init__.py:func:47',
         'file': u'/src/vmprof-python/vmprof/__init__.py',
         'name': u'func'},

        {'line': u'12',
         'time': 100,
         'id': u'py:vmprof-python/example.py:main:12',
         'file': u'vmprof-python/example.py',
         'name': u'main'},

        {'line': u'8',
         'time': 76,
         'id': u'py:vmprof-python/example.py:test_2:8',
         'file': u'vmprof-python/example.py',
         'name': u'test_2'},

        {'line': u'4',
         'time': 6,
         'id': u'py:vmprof-python/example.py:test_1:4',
         'file': u'vmprof-python/example.py',
         'name': u'test_1'}
    ]


def test_function():

    data = process(copy.deepcopy(RAW_DATA))
    key = u'py:/src/vmprof-python/vmprof/__init__.py:func:47'

    assert data[key] == [
        {'line': u'12',
         'time': 100,
         'id': u'py:vmprof-python/example.py:main:12',
         'file': u'vmprof-python/example.py',
         'name': u'main'},

        {'line': u'8',
         'time': 76,
         'id': u'py:vmprof-python/example.py:test_2:8',
         'file': u'vmprof-python/example.py', 'name': u'test_2'},

        {'line': u'4',
         'time': 6,
         'id': u'py:vmprof-python/example.py:test_1:4',
         'file': u'vmprof-python/example.py', 'name': u'test_1'}
    ]
