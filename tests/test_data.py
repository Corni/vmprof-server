import copy

from server.process import process

RAW_DATA = {
    u'addresses': {
        u'140606860724399': u'py:/src/vmprof-python/vmprof/__init__.py:func:47',
        u'140606861238831': u'py:vmprof-python/example.py:main:12',
        u'140606861294511': u'py:vmprof-python/example.py:<module>:1',
        u'140606861529647': u'py:vmprof-python/example.py:test_1:4',
        u'140606861530031': u'py:vmprof-python/example.py:test_2:8'},
    u'profiles': [
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861529647], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831, 140606861530031], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1],
        [[140606861294511, 140606860724399, 140606861238831], 1]]
}


def test_head():
    data = process(copy.deepcopy(RAW_DATA))

    assert data['head'] == [
        (u'py:vmprof-python/example.py:<module>:1', 100),
        (u'py:/src/vmprof-python/vmprof/__init__.py:func:47', 100),
        (u'py:vmprof-python/example.py:main:12', 100),
        (u'py:vmprof-python/example.py:test_2:8', 76),
        (u'py:vmprof-python/example.py:test_1:4', 6)
    ]


def test_profiles():
    data = process(copy.deepcopy(RAW_DATA))

    profiles = data['profiles']

    assert profiles['py:vmprof-python/example.py:main:12'] == {
        'line': u'12',
        'id': u'py:vmprof-python/example.py:main:12',
        'file': u'vmprof-python/example.py',
        'name': u'main'
    }

    assert profiles['py:vmprof-python/example.py:test_2:8'] == {
        'line': u'8',
        'id': u'py:vmprof-python/example.py:test_2:8',
        'file': u'vmprof-python/example.py',
        'name': u'test_2'
    }


def test_calls():
    data = process(copy.deepcopy(RAW_DATA))

    calls = data['calls']

    key = u'py:/src/vmprof-python/vmprof/__init__.py:func:47'

    assert calls[key] == [
        (u'py:vmprof-python/example.py:main:12', 100),
        (u'py:vmprof-python/example.py:test_2:8', 76),
        (u'py:vmprof-python/example.py:test_1:4', 6)
    ]
