language: python
python: 3.5
env:
  - DJANGO_SETTINGS_MODULE=webapp.settings.travis

addons:
  postgresql: "9.3"

before_install:
  - psql -c 'create database vmprof;' -U postgres
  
install:
  - pip install -r requirements/testing.txt
  - pip install -e git://github.com/vmprof/vmprof-python.git@$TRAVIS_BRANCH#egg=vmprof
  - python manage.py migrate

before_script:
  - export CHROME_BIN=/usr/bin/google-chrome
  - sudo apt-get update
  - sudo apt-get install -y libappindicator1 fonts-liberation
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -i google-chrome*.deb
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sleep 3 # give xvfb some time to start
  - python manage.py loaddata log/test/fixtures.yaml
  - python manage.py runserver &
  - sleep 3 # wait for django

script:
  - py.test . -v

notifications:
  irc:
    channels: "irc.freenode.org#baroque-dev"
    template:
      - "%{repository}@%{branch}: %{message} (%{build_url})"
    use_notice: true
    on_success: always
    on_failure: always

  email:
    on_success: change
    on_failure: change
